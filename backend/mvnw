#!/usr/bin/env sh
##---------------------------------------------------------------------
# Maven Wrapper shell script
##---------------------------------------------------------------------
set -e

MAVEN_PROJECTBASEDIR=`dirname "$0"`
MAVEN_PROJECTBASEDIR=`cd "$MAVEN_PROJECTBASEDIR" && pwd -P`

WRAPPER_JAR="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar"
WRAPPER_URL="https://repo1.maven.org/maven2/io/takari/maven-wrapper/0.5.6/maven-wrapper-0.5.6.jar"

download() {
  echo "Downloading maven-wrapper.jar to $WRAPPER_JAR"
  if command -v curl >/dev/null 2>&1; then
    curl -sS -f -L -o "$WRAPPER_JAR" "$WRAPPER_URL"
  elif command -v wget >/dev/null 2>&1; then
    wget -q -O "$WRAPPER_JAR" "$WRAPPER_URL"
  else
    # Try with Java
    java -cp "$MAVEN_PROJECTBASEDIR" -XshowSettings:properties -version >/dev/null 2>&1 || true
    mkdir -p `dirname "$WRAPPER_JAR"`
    # Use a small Java downloader
    cat > /tmp/DownloadWrapper.java <<'JAVA'
import java.io.*;
import java.net.*;
public class DownloadWrapper {
  public static void main(String[] args) throws Exception {
    URL u=new URL(args[0]);
    try(InputStream in=u.openStream(); FileOutputStream out=new FileOutputStream(args[1])){
      byte[] buf=new byte[8192]; int n;
      while((n=in.read(buf))!=-1) out.write(buf,0,n);
    }
  }
}
JAVA
    javac /tmp/DownloadWrapper.java >/dev/null 2>&1
    java -cp /tmp DownloadWrapper "$WRAPPER_URL" "$WRAPPER_JAR"
    rm -f /tmp/DownloadWrapper.java /tmp/DownloadWrapper.class
  fi
}

if [ ! -f "$WRAPPER_JAR" ]; then
  mkdir -p `dirname "$WRAPPER_JAR"`
  download
fi

exec java -jar "$WRAPPER_JAR" "$@"
